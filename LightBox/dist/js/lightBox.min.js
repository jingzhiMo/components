!function(a){var b,c,d,e,f,g,h,i,j,k=document,l=k.body,m=.9*window.innerWidth-20,n=.9*window.innerHeight-20,o=function(a){return this instanceof o?(this.options=a,this.createLightbox(),this.bindEvent(),void 0):new o(a)};o.prototype={constructor:o,isNew:!0,group:{},currentGroup:"",currentIndex:-1,proxyEvent:function(a,b){return function(){return b.apply(a,arguments)}},createLightbox:function(){if(this.isNew){var d='<div id="lightbox_view"><div class="lightbox_pic_area"><img class="lightbox_loading" src="./image/icon/loading.gif" alt=""><img class="lightbox_pic" src alt=""><span class="lightbox_arrow lightbox_prev_arrow" title="上一张"></span><span class="lightbox_arrow lightbox_next_arrow" title="下一张"></span></div><div class="lightbox_caption_area"><div class="lightbox_caption"><p class="lightbpx_pic_desc"></p><span class="lightbox_pic_idx"></span></div></div><i class="lightbox_close" title="关闭"></i></div>',m=k.createDocumentFragment();c=a(d),b=a('<div id="lightbox_mask"></div>'),e=c.find(".lightbox_pic"),f=c.find(".lightbox_loading"),g=c.children(".lightbox_pic_area"),h=c.find(".lightbox_caption"),i=c.find(".lightbox_next_arrow"),j=c.find(".lightbox_prev_arrow"),m.appendChild(b[0]),m.appendChild(c[0]),l.appendChild(m),this.isNew=!1}},loadImg:function(a){var d=a.target||a.srcElement||a,e=d.dataset.src,f=new Image,g=this;f.src=e,f.onload=function(){g.showImg(d,f)},b.show(),c.show()},showImg:function(b,c){var d,i,j=b.dataset,k=this.group,l=j.group,o=j.caption,p=c.width>m?m:c.width,q=c.height>n?n:c.height;k[l]||(k[l]=a(".lightbox_img[data-role=lightbox][data-group="+l+"]")),d=k[l].index(b)+1,i=k[l].length,f.addClass("hide"),g.animate({width:p+"px",height:q+"px"},200,"linear",this.proxyEvent(this,function(){e.attr("src",c.src).css({width:p+"px",height:q+"px"}).show().removeClass("hide"),this.currentIndex=d-1,this.currentGroup=l,h.children("p").html(o),h.children("span").html(d+"  of  "+i),this.arrowCtrl()}))},arrowCtrl:function(){var a=this.group[this.currentGroup],b=a.length,c=this.currentIndex;j.removeClass("hide"),i.removeClass("hide"),0===c&&j.addClass("hide"),c+1===b&&i.addClass("hide")},showLoading:function(){e.addClass("hide"),f.removeClass("hide")},nextImg:function(){var a=this.group[this.currentGroup],b=this.currentIndex+1>=a.length?a.length-1:this.currentIndex+1,c=this.group[this.currentGroup][b];this.showLoading(),this.loadImg(c)},prevImg:function(){var a=(this.group[this.currentGroup],this.currentIndex-1<0?0:this.currentIndex-1),b=this.group[this.currentGroup][a];this.showLoading(),this.loadImg(b)},close:function(a){var d=a.keyCode;if(void 0===d||27===d)return b.hide(),c.hide(),e.addClass("hide"),f.removeClass("hide"),!1},bindEvent:function(){for(var d=this.options,e=a(d.boxes),f=0,g=e.length;g>f;f++)e[f].on("click",".lightbox_img[data-role=lightbox]",this.proxyEvent(this,this.loadImg));return b.add(c.find(".lightbox_close")).on("click",this.proxyEvent(this,this.close)),a(document).on("keyup",this.proxyEvent(this,this.close)),c.on("click",".lightbox_prev_arrow",this.proxyEvent(this,this.prevImg)),c.on("click",".lightbox_next_arrow",this.proxyEvent(this,this.nextImg)),!1}},window.lightbox={init:function(a){d=d?d:new o(a)},getGroupByName:function(a){return d.group[a]},setGroupByName:function(a,b){d.group[a]=b}}}(jQuery);